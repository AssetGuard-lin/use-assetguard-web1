<script>
    // 1. Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    const status = document.getElementById("status-text");
    const loginForm = document.getElementById("login-form");
    const dashMenu = document.getElementById("dashboard-menu");

    // 2. The "Normal" State Monitor
    auth.onAuthStateChanged((user) => {
        if (user) {
            // USER IS LOGGED IN
            status.innerText = "Welcome, " + user.email;
            status.style.color = "green";
            loginForm.style.display = "none";
            dashMenu.style.display = "block";
            
            // Redirect to sales only if the user is currently on the login page
            if (window.location.pathname.endsWith("index.html") || window.location.pathname.endsWith("/")) {
                setTimeout(() => { window.location.href = "sales.html"; }, 1000);
            }
        } else {
            // USER IS NOT LOGGED IN
            status.innerText = "Please sign in to continue";
            status.style.color = "#666";
            loginForm.style.display = "block";
            dashMenu.style.display = "none";
        }
    });

    // 3. The Login Function
    function handleLogin() {
        const email = document.getElementById("user").value.trim();
        const pass = document.getElementById("pass").value.trim();
        const btn = document.getElementById("login-btn");

        if(!email || !pass) return alert("Enter credentials");

        status.innerText = "Authenticating...";
        btn.disabled = true;

        // Set to SESSION: This makes it behave like a "normal" site
        // where closing the tab/browser ends the session.
        auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
            .then(() => {
                return auth.signInWithEmailAndPassword(email, pass);
            })
            .catch((error) => {
                status.innerText = "Error: " + error.message;
                status.style.color = "red";
                btn.disabled = false;
            });
    }

    // 4. The Logout Function
    function logout() {
        auth.signOut().then(() => {
            window.location.href = "index.html";
        });
    }
</script>
